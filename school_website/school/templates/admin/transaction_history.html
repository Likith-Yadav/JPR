{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'admin/css/custom_admin.css' %}">
{% endblock %}

{% block content %}
<div id="content-main">
    <h1>Transaction History for {{ user_profile.Name }}</h1>
    
    <!-- One-time Fees Section -->
    <div class="module">
        <h2>One-time Fees</h2>
        <table>
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Receipt</th>
                </tr>
            </thead>
            <tbody>
                {% for fee in one_time_fees %}
                <tr class="{% if fee.status == 'Not Paid' %}not-paid{% endif %}">
                    <td>{{ fee.category }}</td>
                    <td>{{ fee.status }}</td>
                    <td>{% if fee.amount %}₹{{ fee.amount }}{% else %}-{% endif %}</td>
                    <td>{% if fee.date %}{{ fee.date|date:"d M Y" }}{% else %}-{% endif %}</td>
                    <td>
                        {% if fee.transaction %}
                            <a href="{% url 'admin:download_receipt' fee.transaction.transaction_id %}" class="button" target="_blank">Download</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Monthly Fees Section -->
    <div class="module">
        <h2>Monthly Fees</h2>
        <table>
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Status</th>
                    <th>Amount</th>
                    <th>Receipt</th>
                </tr>
            </thead>
            <tbody>
                {% for month in months %}
                <tr class="{% if not month.paid %}not-paid{% endif %}">
                    <td>{{ month.month }}</td>
                    <td>{% if month.paid %}Paid{% else %}Not Paid{% endif %}</td>
                    <td>{% if month.total_amount %}₹{{ month.total_amount }}{% else %}-{% endif %}</td>
                    <td>
                        {% if month.transaction %}
                            <a href="{% url 'admin:download_receipt' month.transaction.transaction_id %}" class="button" target="_blank">Download</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- All Transactions Section -->
    <div class="module">
        <h2>All Transactions</h2>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Transaction ID</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Payment Mode</th>
                    <th>Receipt</th>
                </tr>
            </thead>
            <tbody>
                {% for transaction in all_transactions %}
                <tr>
                    <td>{{ transaction.date|date:"d M Y" }}</td>
                    <td>{{ transaction.transaction_id }}</td>
                    <td>₹{{ transaction.total_amount }}</td>
                    <td>{% if transaction.status %}Success{% else %}Failed{% endif %}</td>
                    <td>{{ transaction.payment_mode }}</td>
                    <td>
                        {% if transaction.status %}
                            <a href="{% url 'admin:download_receipt' transaction.transaction_id %}" class="button" target="_blank">Download</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    .not-paid {
        background-color: #fff3f3;
    }
    .module {
        margin-bottom: 2em;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    th {
        background-color: #f5f5f5;
    }
    .button {
        display: inline-block;
        padding: 4px 8px;
        background-color: #79aec8;
        color: white;
        text-decoration: none;
        border-radius: 4px;
    }
    .button:hover {
        background-color: #417690;
    }
</style>
{% endblock %} 